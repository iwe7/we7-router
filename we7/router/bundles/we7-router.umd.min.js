!function(r,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("rxjs/observable/fromPromise"),require("rxjs/observable/of"),require("rxjs/operator/concatAll"),require("rxjs/operator/every"),require("rxjs/operator/last"),require("rxjs/operator/map"),require("rxjs/operator/mergeAll"),require("@angular/router")):"function"==typeof define&&define.amd?define(["exports","@angular/core","rxjs/observable/fromPromise","rxjs/observable/of","rxjs/operator/concatAll","rxjs/operator/every","rxjs/operator/last","rxjs/operator/map","rxjs/operator/mergeAll","@angular/router"],e):e(r["we7-router"]={},r.ng.core,r.Rx.Observable,r.Rx.Observable,r.Rx.Observable.prototype,r.Rx.Observable.prototype,r.Rx.Observable.prototype,r.Rx.Observable.prototype,r.Rx.Observable.prototype,r.ng.router)}(this,function(r,e,t,n,a,o,i,s,p,u){"use strict";var c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,e){r.__proto__=e}||function(r,e){for(var t in e)e.hasOwnProperty(t)&&(r[t]=e[t])};function h(r,e){function t(){this.constructor=r}c(r,e),r.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}function m(r,e){for(var t in r)r.hasOwnProperty(t)&&e(r[t],t)}function l(r){var e=r.segments,t="",n="";return e.map(function(r,e){0===e?t=r.path:n+=r.path+"/"}),{root:"app/index.php","do":t,ext:n}}function f(r){var e=r.segments,t="",n="";return e.map(function(r,e){0===e?t=r.path:n+=r.path}),{root:"web/index.php","do":t,ext:n}}function g(r){var o;return(o={},location.search.replace(/^\?/,"").split("&").filter(function(r,e){if(""!==r&&r.indexOf("="))return!0}).forEach(function(r,e){var t=r.indexOf("="),n=r.substring(0,t),a=r.substring(t+1);o[n]=a}),o)[r]}function y(){var r={},e=g("a");e&&(r.a=e);var t=g("c");t&&(r.c=t);var n=g("i");n&&(r.i=n);var a=g("m");return a&&(r.m=a),r}function v(r){return(e=r,encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")).replace(/%3B/gi,";");var e}function d(r){return decodeURIComponent(r)}function P(r){return d(r.replace(/\+/g,"%20"))}var O=/^[^\/()?;=&#]+/;function x(r){var e=r.match(O);return console.log("matchSegments",e),e?e[0]:""}var b=/^[^=?&#]+/;var R=/^[^?&#]+/;function M(t,r,n){if(!t.hasChildren())return n(t);if(r){var e=t.children[u.PRIMARY_OUTLET]?M(t.children[u.PRIMARY_OUTLET],!1,n):"",a=[];return m(t.children,function(r,e){e!==u.PRIMARY_OUTLET&&a.push(e+":"+M(r,!1,n))}),0<a.length?e+"("+a.join("//")+")":e}var o,i,s,p=(i=function(r,e){return e===u.PRIMARY_OUTLET?[M(t.children[u.PRIMARY_OUTLET],!1,n)]:[e+":"+M(r,!1,n)]},s=[],m((o=t).children,function(r,e){e===u.PRIMARY_OUTLET&&(s=s.concat(i(r,e)))}),m(o.children,function(r,e){e!==u.PRIMARY_OUTLET&&(s=s.concat(i(r,e)))}),s);return n(t)+"/("+p.join("//")+")"}function w(t){var r=Object.keys(t).map(function(e){var r=t[e];return Array.isArray(r)?r.map(function(r){return v(e)+"="+v(r)}).join("&"):v(e)+"="+v(r)});return r.length?"?"+r.join("&"):""}var j=function(){function r(r){this.url=r,this.params={},this.num=0,this.remaining=r,this.copyUrl=r,this.consumeOptional("/"),this.consumeOptional("web"),this.consumeOptional("/"),this.consumeOptional("app"),this.consumeOptional("/"),this.consumeOptional("index.php"),this.parseQueryParams()}return r.prototype.getParams=function(){return this.params},r.prototype.parseRootSegment=function(){return this.consumeOptional("/"),new u.UrlSegmentGroup([],this.parseChildren())},r.prototype.parseQueryParams=function(){if(this.consumeOptional("?"))for(;this.parseQueryParam(),this.consumeOptional("&"););},r.prototype.parseFragment=function(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null},r.prototype.parseChildren=function(){var e=this,t=[];this.params["do"]&&t.push(new u.UrlSegment(d(this.params["do"]),this.parseMatrixParams()));var r={};(this.params.ext||"").split("/").map(function(r){0<r.length&&t.push(new u.UrlSegment(d(r),e.parseMatrixParams()))});var n={};return(0<t.length||0<Object.keys(r).length)&&(n[u.PRIMARY_OUTLET]=new u.UrlSegmentGroup(t,r)),n},r.prototype.parseWe7Segment=function(){var r=x(this.remaining);if(""===r&&this.peekStartsWith(";"))throw new Error("Empty path url segment cannot have parameters: '"+this.remaining+"'.");return this.capture(r),"web"===r||"index.php"===r||"app"===r?null:new u.UrlSegment(d(r),this.parseMatrixParams())},r.prototype.parseSegment=function(){var r=x(this.remaining);if(""===r&&this.peekStartsWith(";"))throw new Error("Empty path url segment cannot have parameters: '"+this.remaining+"'.");return this.capture(r),new u.UrlSegment(d(r),this.parseMatrixParams())},r.prototype.parseMatrixParams=function(){for(var r={};this.consumeOptional(";");)this.parseParam(r);return r},r.prototype.parseParam=function(r){var e=x(this.remaining);if(e){this.capture(e);var t="";if(this.consumeOptional("=")){var n=x(this.remaining);n&&(t=n,this.capture(t))}r[d(e)]=d(t)}},r.prototype.parseQueryParam=function(){var r,e,t=(r=this.remaining,(e=r.match(b))?e[0]:"");if(t){this.capture(t);var n,a,o="";if(this.consumeOptional("=")){var i=(n=this.remaining,(a=n.match(R))?a[0]:"");i&&(o=i,this.capture(o))}var s=P(t),p=P(o);if(this.params.hasOwnProperty(s)){var u=this.params[s];Array.isArray(u)||(u=[u],this.params[s]=u),u.push(p)}else this.params[s]=p}},r.prototype.parseParens=function(r){var e={};for(this.capture("(");!this.consumeOptional(")")&&0<this.remaining.length;){var t=x(this.remaining),n=this.remaining[t.length];if("/"!==n&&")"!==n&&";"!==n)throw new Error("Cannot parse url '"+this.url+"'");var a=undefined;-1<t.indexOf(":")?(a=t.substr(0,t.indexOf(":")),this.capture(a),this.capture(":")):r&&(a=u.PRIMARY_OUTLET);var o=this.parseChildren();e[a]=1===Object.keys(o).length?o[u.PRIMARY_OUTLET]:new u.UrlSegmentGroup([],o),this.consumeOptional("//")}return e},r.prototype.peekStartsWith=function(r){return this.remaining.startsWith(r)},r.prototype.consumeOptional=function(r){return!!this.peekStartsWith(r)&&(this.remaining=this.remaining.substring(r.length),!0)},r.prototype.capture=function(r){if(!this.consumeOptional(r))throw new Error('Expected "'+r+'".')},r}(),U=function(){function r(){}return r.prototype.parse=function(r){var e=new j(r);return new q(e.parseRootSegment(),e.getParams(),e.parseFragment())},r.prototype.serialize=function(r){var e=M(r.root,!0,l),t=y();for(var n in r.queryParams)"do"===n||"ext"===n||(t[n]=r.queryParams[n]);var a=w(t),o="string"==typeof r.fragment?"#"+v(r.fragment):"";return""+e.root+a+"&do="+e["do"]+"&ext="+e.ext+o},r}(),_=new U,q=function(a){function r(r,e,t){var n=a.call(this)||this;return n.root=r,n.queryParams=e,n.fragment=t,n}return h(r,a),Object.defineProperty(r.prototype,"queryParamMap",{get:function(){return this._queryParamMap||(this._queryParamMap=u.convertToParamMap(this.queryParams)),this._queryParamMap},enumerable:!0,configurable:!0}),r.prototype.toString=function(){return _.serialize(this)},r}(u.UrlTree),T=function(){function r(){}return r.prototype.parse=function(r){var e=new j(r);return new A(e.parseRootSegment(),e.getParams(),e.parseFragment())},r.prototype.serialize=function(r){var e=M(r.root,!0,f),t=y();for(var n in r.queryParams)"do"===n||"ext"===n||(t[n]=r.queryParams[n]);var a=w(t),o="string"==typeof r.fragment?"#"+v(r.fragment):"";return""+e.root+a+"&do="+e["do"]+"&ext="+e.ext+o},r}(),S=new T,A=function(a){function r(r,e,t){var n=a.call(this)||this;return n.root=r,n.queryParams=e,n.fragment=t,n}return h(r,a),Object.defineProperty(r.prototype,"queryParamMap",{get:function(){return this._queryParamMap||(this._queryParamMap=u.convertToParamMap(this.queryParams)),this._queryParamMap},enumerable:!0,configurable:!0}),r.prototype.toString=function(){return S.serialize(this)},r}(u.UrlTree),E=function(){function r(){}return r.forRoot=function(){return{ngModule:r,providers:[{provide:u.UrlSerializer,useClass:U}]}},r}();E.decorators=[{type:e.NgModule,args:[{}]}],E.ctorParameters=function(){return[]};var I=function(){function r(){}return r.forRoot=function(){return{ngModule:r,providers:[{provide:u.UrlSerializer,useClass:T}]}},r}();I.decorators=[{type:e.NgModule,args:[{}]}],I.ctorParameters=function(){return[]},r.MobileUrlSerializer=U,r.WebUrlSerializer=T,r.We7MobileRouterModule=E,r.We7WebRouterModule=I,Object.defineProperty(r,"__esModule",{value:!0})});
//# sourceMappingURL=we7-router.umd.min.js.map
