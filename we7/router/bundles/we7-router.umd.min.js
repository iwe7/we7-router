!function(r,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("rxjs/observable/fromPromise"),require("rxjs/observable/of"),require("rxjs/operator/concatAll"),require("rxjs/operator/every"),require("rxjs/operator/last"),require("rxjs/operator/map"),require("rxjs/operator/mergeAll"),require("@angular/router")):"function"==typeof define&&define.amd?define(["exports","@angular/core","rxjs/observable/fromPromise","rxjs/observable/of","rxjs/operator/concatAll","rxjs/operator/every","rxjs/operator/last","rxjs/operator/map","rxjs/operator/mergeAll","@angular/router"],e):e(r["we7-router"]={},r.ng.core,r.Rx.Observable,r.Rx.Observable,r.Rx.Observable.prototype,r.Rx.Observable.prototype,r.Rx.Observable.prototype,r.Rx.Observable.prototype,r.Rx.Observable.prototype,r.ng.router)}(this,function(r,e,t,n,a,i,o,s,p,h){"use strict";var u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,e){r.__proto__=e}||function(r,e){for(var t in e)e.hasOwnProperty(t)&&(r[t]=e[t])};function c(r,e){for(var t in r)r.hasOwnProperty(t)&&e(r[t],t)}function m(r){var e,t,n,a,i,o=r.segments;return 0<(i=r.segments).length&&"app"===i[0].path?("home"===(a={root:"app/index.php",c:1<(n=o).length?n[1].path:"home"}).c||(a.a=2<n.length?n[2].path:"site","entry"===a.c?(a.m=3<n.length?n[3].path:"we7_coupon",a["do"]=4<n.length?n[4].path:"list",a.version_id=5<n.length?n[5].path:"1.0.0"):(a["do"]=3<n.length?n[3].path:"list",a.version_id=4<n.length?n[4].path:"1.0.0")),a):((t={root:"web/index.php",c:1<(e=o).length?e[1].path:"home"}).a=2<e.length?e[2].path:"welcome","site"===t.c?(t.m=3<e.length?e[3].path:"we7_coupon",t["do"]=4<e.length?e[4].path:"welcome",t.version_id=5<e.length?e[5].path:"1.0.0"):t.c,t["do"]=3<e.length?e[3].path:"welcome",t.version_id=4<e.length?e[4].path:"1.0.0",t)}function l(r){var i;return(i={},location.search.replace(/^\?/,"").split("&").filter(function(r,e){if(""!==r&&r.indexOf("="))return!0}).forEach(function(r,e){var t=r.indexOf("="),n=r.substring(0,t),a=r.substring(t+1);i[n]=a}),i)[r]}function f(r){return(e=r,encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")).replace(/%3B/gi,";");var e}function g(r){return decodeURIComponent(r)}function y(r){return g(r.replace(/\+/g,"%20"))}var v=/^[^\/()?;=&#]+/;function O(r){var e=r.match(v);return console.log("matchSegments",e),e?e[0]:""}var d=/^[^=?&#]+/;var P=/^[^?&#]+/;function x(t,r,n){if(!t.hasChildren())return n(t);if(r){var e=t.children[h.PRIMARY_OUTLET]?x(t.children[h.PRIMARY_OUTLET],!1,n):"",a=[];return c(t.children,function(r,e){e!==h.PRIMARY_OUTLET&&a.push(e+":"+x(r,!1,n))}),0<a.length?e+"("+a.join("//")+")":e}var i,o,s,p=(o=function(r,e){return e===h.PRIMARY_OUTLET?[x(t.children[h.PRIMARY_OUTLET],!1,n)]:[e+":"+x(r,!1,n)]},s=[],c((i=t).children,function(r,e){e===h.PRIMARY_OUTLET&&(s=s.concat(o(r,e)))}),c(i.children,function(r,e){e!==h.PRIMARY_OUTLET&&(s=s.concat(o(r,e)))}),s);return n(t)+"/("+p.join("//")+")"}var b=function(){function r(r){this.url=r,this.params={},this.num=0,this.remaining=r,this.copyUrl=r}return r.prototype.getParams=function(){return this.params},r.prototype.parseRootSegment=function(){return this.consumeOptional("/"),new h.UrlSegmentGroup([],this.parseChildren())},r.prototype.parseQueryParams=function(){if(this.consumeOptional("?"))for(;this.parseQueryParam(),this.consumeOptional("&"););},r.prototype.parseFragment=function(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null},r.prototype.parseChildren=function(){var e=this,t=[];this.consumeOptional("/"),this.consumeOptional("app")&&t.push(new h.UrlSegment(g("app"),this.parseMatrixParams())),this.consumeOptional("/"),this.consumeOptional("web")&&t.push(new h.UrlSegment(g("web"),this.parseMatrixParams())),this.consumeOptional("/"),this.consumeOptional("index.php"),this.parseQueryParams(),this.params.c&&t.push(new h.UrlSegment(g(this.params.c),this.parseMatrixParams())),this.params.a&&t.push(new h.UrlSegment(g(this.params.a),this.parseMatrixParams())),this.params.m&&t.push(new h.UrlSegment(g(this.params.m),this.parseMatrixParams())),this.params["do"]&&t.push(new h.UrlSegment(g(this.params["do"]),this.parseMatrixParams()));var r={};(this.params.ext||"").split("|").map(function(r){0<r.length&&t.push(new h.UrlSegment(g(r),e.parseMatrixParams()))});var n={};return(0<t.length||0<Object.keys(r).length)&&(n[h.PRIMARY_OUTLET]=new h.UrlSegmentGroup(t,r)),console.log(n),n},r.prototype.parseWe7Segment=function(){var r=O(this.remaining);if(""===r&&this.peekStartsWith(";"))throw new Error("Empty path url segment cannot have parameters: '"+this.remaining+"'.");return this.capture(r),"web"===r||"index.php"===r||"app"===r?null:new h.UrlSegment(g(r),this.parseMatrixParams())},r.prototype.parseSegment=function(){var r=O(this.remaining);if(""===r&&this.peekStartsWith(";"))throw new Error("Empty path url segment cannot have parameters: '"+this.remaining+"'.");return this.capture(r),new h.UrlSegment(g(r),this.parseMatrixParams())},r.prototype.parseMatrixParams=function(){for(var r={};this.consumeOptional(";");)this.parseParam(r);return r},r.prototype.parseParam=function(r){var e=O(this.remaining);if(e){this.capture(e);var t="";if(this.consumeOptional("=")){var n=O(this.remaining);n&&(t=n,this.capture(t))}r[g(e)]=g(t)}},r.prototype.parseQueryParam=function(){var r,e,t=(r=this.remaining,(e=r.match(d))?e[0]:"");if(t){this.capture(t);var n,a,i="";if(this.consumeOptional("=")){var o=(n=this.remaining,(a=n.match(P))?a[0]:"");o&&(i=o,this.capture(i))}var s=y(t),p=y(i);if(this.params.hasOwnProperty(s)){var h=this.params[s];Array.isArray(h)||(h=[h],this.params[s]=h),h.push(p)}else this.params[s]=p}},r.prototype.parseParens=function(r){var e={};for(this.capture("(");!this.consumeOptional(")")&&0<this.remaining.length;){var t=O(this.remaining),n=this.remaining[t.length];if("/"!==n&&")"!==n&&";"!==n)throw new Error("Cannot parse url '"+this.url+"'");var a=undefined;-1<t.indexOf(":")?(a=t.substr(0,t.indexOf(":")),this.capture(a),this.capture(":")):r&&(a=h.PRIMARY_OUTLET);var i=this.parseChildren();e[a]=1===Object.keys(i).length?i[h.PRIMARY_OUTLET]:new h.UrlSegmentGroup([],i),this.consumeOptional("//")}return e},r.prototype.peekStartsWith=function(r){return this.remaining.startsWith(r)},r.prototype.consumeOptional=function(r){return!!this.peekStartsWith(r)&&(this.remaining=this.remaining.substring(r.length),!0)},r.prototype.capture=function(r){if(!this.consumeOptional(r))throw new Error('Expected "'+r+'".')},r}(),w=function(){function r(){}return r.prototype.parse=function(r){var e=new b(r);return new j(e.parseRootSegment(),e.getParams(),e.parseFragment())},r.prototype.serialize=function(r){var e,t,n=x(r.root,!0,m),a=(e={},(t=l("i"))&&(e.i=t),l("j")&&(e.j=t),e.poverby="imeepos",e),i=r.queryParams;a=Object.assign({},a,i,n);var o,s,p={};for(var h in a)"root"===h||(p[h]=a[h]);return""+n.root+(o=p,(s=Object.keys(o).map(function(e){var r=o[e];return Array.isArray(r)?r.map(function(r){return f(e)+"="+f(r)}).join("&"):f(e)+"="+f(r)})).length?"?"+s.join("&"):"")+("string"==typeof r.fragment?"#"+f(r.fragment):"")},r}(),R=new w,j=function(a){function r(r,e,t){var n=a.call(this)||this;return n.root=r,n.queryParams=e,n.fragment=t,n}return function(r,e){function t(){this.constructor=r}u(r,e),r.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}(r,a),Object.defineProperty(r.prototype,"queryParamMap",{get:function(){return this._queryParamMap||(this._queryParamMap=h.convertToParamMap(this.queryParams)),this._queryParamMap},enumerable:!0,configurable:!0}),r.prototype.toString=function(){return R.serialize(this)},r}(h.UrlTree);r.MeepoUrlSerializer=w,Object.defineProperty(r,"__esModule",{value:!0})});
//# sourceMappingURL=we7-router.umd.min.js.map
