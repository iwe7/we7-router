!function(r,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("rxjs/observable/fromPromise"),require("rxjs/observable/of"),require("rxjs/operator/concatAll"),require("rxjs/operator/every"),require("rxjs/operator/last"),require("rxjs/operator/map"),require("rxjs/operator/mergeAll"),require("@angular/router")):"function"==typeof define&&define.amd?define(["exports","@angular/core","rxjs/observable/fromPromise","rxjs/observable/of","rxjs/operator/concatAll","rxjs/operator/every","rxjs/operator/last","rxjs/operator/map","rxjs/operator/mergeAll","@angular/router"],e):e(r["we7-router"]={},r.ng.core,r.Rx.Observable,r.Rx.Observable,r.Rx.Observable.prototype,r.Rx.Observable.prototype,r.Rx.Observable.prototype,r.Rx.Observable.prototype,r.Rx.Observable.prototype,r.ng.router)}(this,function(r,e,t,n,a,o,i,s,p,u){"use strict";var c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,e){r.__proto__=e}||function(r,e){for(var t in e)e.hasOwnProperty(t)&&(r[t]=e[t])};function h(r,e){function t(){this.constructor=r}c(r,e),r.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}function m(r,e){for(var t in r)r.hasOwnProperty(t)&&e(r[t],t)}function l(r){var e="app/index.php";return e+=f(r.segments)}function f(r){var e="";return e+="?ext="+r.map(function(r){return""+v((e=r).path)+(t=e.parameters,Object.keys(t).map(function(r){return";"+v(r)+"="+v(t[r])}).join(""));var e,t}).join("/")}function g(r){var e="web/index.php";return e+=f(r.segments)}function y(r){return b(r).replace(/%3B/gi,";")}function v(r){return b(r).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function P(r){return decodeURIComponent(r)}function d(r){return P(r.replace(/\+/g,"%20"))}function b(r){return encodeURIComponent(r).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}var O=/^[^\/()?;=&#]+/;function R(r){var e=r.match(O);return console.log("matchSegments",e),e?e[0]:""}var x=/^[^=?&#]+/;var M=/^[^?&#]+/;function j(t,r,n){if(!t.hasChildren())return n(t);if(r){var e=t.children[u.PRIMARY_OUTLET]?j(t.children[u.PRIMARY_OUTLET],!1,n):"",a=[];return m(t.children,function(r,e){e!==u.PRIMARY_OUTLET&&a.push(e+":"+j(r,!1,n))}),0<a.length?e+"("+a.join("//")+")":e}var o,i,s,p=(i=function(r,e){return e===u.PRIMARY_OUTLET?[j(t.children[u.PRIMARY_OUTLET],!1,n)]:[e+":"+j(r,!1,n)]},s=[],m((o=t).children,function(r,e){e===u.PRIMARY_OUTLET&&(s=s.concat(i(r,e)))}),m(o.children,function(r,e){e!==u.PRIMARY_OUTLET&&(s=s.concat(i(r,e)))}),s);return n(t)+"/("+p.join("//")+")"}function w(t){var r=Object.keys(t).map(function(e){var r=t[e];return Array.isArray(r)?r.map(function(r){return y(e)+"="+y(r)}).join("&"):y(e)+"="+y(r)});return r.length?"&"+r.join("&"):""}var U=function(){function r(r){this.url=r,this.params={},this.num=0,this.remaining=r,this.copyUrl=r,this.params=this.parseQueryParams(!0)}return r.prototype.parseRootSegment=function(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new u.UrlSegmentGroup([],{}):new u.UrlSegmentGroup([],this.parseChildren())},r.prototype.parseQueryParams=function(r){if(void 0===r&&(r=!1),this.consumeOptional("?"))for(;this.parseQueryParam(),this.consumeOptional("&"););return this.params},r.prototype.parseFragment=function(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null},r.prototype.parseChildren=function(){var r=[];this.params["do"]&&r.push(new u.UrlSegment(P(this.params["do"]),this.parseMatrixParams())),console.log(this.params);var e={},t=((this.params.ext||"").split("/"),{});return(0<r.length||0<Object.keys(e).length)&&(t[u.PRIMARY_OUTLET]=new u.UrlSegmentGroup(r,e)),t},r.prototype.parseWe7Segment=function(){var r=R(this.remaining);if(""===r&&this.peekStartsWith(";"))throw new Error("Empty path url segment cannot have parameters: '"+this.remaining+"'.");return this.capture(r),"web"===r||"index.php"===r||"app"===r?null:new u.UrlSegment(P(r),this.parseMatrixParams())},r.prototype.parseSegment=function(){var r=R(this.remaining);if(""===r&&this.peekStartsWith(";"))throw new Error("Empty path url segment cannot have parameters: '"+this.remaining+"'.");return this.capture(r),new u.UrlSegment(P(r),this.parseMatrixParams())},r.prototype.parseMatrixParams=function(){for(var r={};this.consumeOptional(";");)this.parseParam(r);return r},r.prototype.parseParam=function(r){var e=R(this.remaining);if(e){this.capture(e);var t="";if(this.consumeOptional("=")){var n=R(this.remaining);n&&(t=n,this.capture(t))}r[P(e)]=P(t)}},r.prototype.parseQueryParam=function(){var r,e,t=(r=this.remaining,(e=r.match(x))?e[0]:"");if(t){this.capture(t);var n,a,o="";if(this.consumeOptional("=")){var i=(n=this.remaining,(a=n.match(M))?a[0]:"");i&&(o=i,this.capture(o))}var s=d(t),p=d(o);if(this.params.hasOwnProperty(s)){var u=this.params[s];Array.isArray(u)||(u=[u],this.params[s]=u),u.push(p)}else this.params[s]=p}},r.prototype.parseParens=function(r){var e={};for(this.capture("(");!this.consumeOptional(")")&&0<this.remaining.length;){var t=R(this.remaining),n=this.remaining[t.length];if("/"!==n&&")"!==n&&";"!==n)throw new Error("Cannot parse url '"+this.url+"'");var a=undefined;-1<t.indexOf(":")?(a=t.substr(0,t.indexOf(":")),this.capture(a),this.capture(":")):r&&(a=u.PRIMARY_OUTLET);var o=this.parseChildren();e[a]=1===Object.keys(o).length?o[u.PRIMARY_OUTLET]:new u.UrlSegmentGroup([],o),this.consumeOptional("//")}return e},r.prototype.peekStartsWith=function(r){return this.remaining.startsWith(r)},r.prototype.consumeOptional=function(r){return!!this.peekStartsWith(r)&&(this.remaining=this.remaining.substring(r.length),!0)},r.prototype.capture=function(r){if(!this.consumeOptional(r))throw new Error('Expected "'+r+'".')},r}(),_=function(){function r(){}return r.prototype.parse=function(r){var e=new U("/"+r);return new T(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())},r.prototype.serialize=function(r){return""+("/"+j(r.root,!0,l))+w(r.queryParams)+("string"==typeof r.fragment?"#"+y(r.fragment):"")},r}(),S=new _,T=function(a){function r(r,e,t){var n=a.call(this)||this;return n.root=r,n.queryParams=e,n.fragment=t,n}return h(r,a),Object.defineProperty(r.prototype,"queryParamMap",{get:function(){return this._queryParamMap||(this._queryParamMap=u.convertToParamMap(this.queryParams)),this._queryParamMap},enumerable:!0,configurable:!0}),r.prototype.toString=function(){return S.serialize(this)},r}(u.UrlTree),q=function(){function r(){}return r.prototype.parse=function(r){var e=new U(r);return new E(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())},r.prototype.serialize=function(r){return""+("/"+j(r.root,!0,g))+w(r.queryParams)+("string"==typeof r.fragment?"#"+y(r.fragment):"")},r}(),A=new q,E=function(a){function r(r,e,t){var n=a.call(this)||this;return n.root=r,n.queryParams=e,n.fragment=t,n}return h(r,a),Object.defineProperty(r.prototype,"queryParamMap",{get:function(){return this._queryParamMap||(this._queryParamMap=u.convertToParamMap(this.queryParams)),this._queryParamMap},enumerable:!0,configurable:!0}),r.prototype.toString=function(){return A.serialize(this)},r}(u.UrlTree),I=function(){function r(){}return r.forRoot=function(){return{ngModule:r,providers:[{provide:u.UrlSerializer,useClass:_}]}},r}();I.decorators=[{type:e.NgModule,args:[{}]}],I.ctorParameters=function(){return[]};var W=function(){function r(){}return r.forRoot=function(){return{ngModule:r,providers:[{provide:u.UrlSerializer,useClass:q}]}},r}();W.decorators=[{type:e.NgModule,args:[{}]}],W.ctorParameters=function(){return[]},r.MobileUrlSerializer=_,r.WebUrlSerializer=q,r.We7MobileRouterModule=I,r.We7WebRouterModule=W,Object.defineProperty(r,"__esModule",{value:!0})});
//# sourceMappingURL=we7-router.umd.min.js.map
